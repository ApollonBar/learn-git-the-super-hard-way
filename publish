#!/bin/bash

set -euxo pipefail

make docker
make -j32

git read-tree "$(git mktree </dev/null)"
git add -f \
    chapter*.md \
    cheatsheet.md \
    README.md \
    ROADMAP \
    LICENSE
TREE="$(git write-tree)"
COMMIT="$(git commit-tree "$TREE" -p HEAD -m "publish" -S)"
git push --force-with-lease origin "$COMMIT:master"
git reset --mixed
